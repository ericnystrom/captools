# captools: Toolkit for legal historians to work with bulk data from the Caselaw Access Project (CAP)

Last updated: November 30, 2020

## Overview

The `captools` utilities were written by Eric
Nystrom (<http://ericnystrom.org>) to facilitate analyzing full-text court
opinion data from the Caselaw Access Project <http://case.law>, for example by
examining key words in context (KWIC).

The utilities are all licensed under the MIT License. In addition
to this README, most of the scripts are excessively commented. If
you find these useful, I'd be very interested to hear how you are
using them (via email, Github, Twitter, website).

## Tools
<!-- UPDATE -->
- `cap-kwic`: Search for a key word in opinion text, output it
  in context with additional info. (Perl)
- `cap-pos`: Like `cap-kwic`, but key word and context are run through
  a Part of Speech (POS) tagger first. (Perl)
- `cap-get-followers`: Reads output of `cap-pos` and outputs a
  condensed TSV featuring the noun/noun phrase that follows the "term"
  in the KWIC output. (Perl)
- `cap-map-followers`: Given input from `cap-get-followers` and a
  three-column TSV that contains words mapped to categories of
  meaning, applies the classifications to the results. (Awk)
- `cap-apply-followers`: With input from `cap-map-followers`, apply
  the word classifications to the KWIC output. (Awk)
  
## Installation

Download and place somewhere in your $PATH, or call the scripts
with a complete path on the command line.

*Dependencies:* `cap-kwic` depends on Perl and the
 packages LibJSON, Text::Unidecode, Text::Trim,
 and Getopt::Long. These can be downloaded from CPAN or are
 provided in Debian by the `libjson-perl`, `libtext-unidecode-perl`, and
`libtext-trim-perl` packages. `cap-pos` also relies on
 Lingua::EN::Tagger, available from CPAN or in the Debian package
 `liblingua-en-tagger-perl`. 

## The Data

These tools were designed to work with the "bulk download" data in
JSON form, from the good folks at the Caselaw Access Project
(<https://case.law/download/>). Note that a "researcher agreement" is
needed in order to download this data for nearly all jurisdictions.

## Usage

The `cap-tools` utilities were designed to be friendly to
handling large input data files. They avoid reading all the input into
memory before acting on it, instead assembling and acting upon one
JSON object at a time from the data input. They can read a JSON file
specified on the command line, but the preferred method is to pipe
input from another source, such as data uncompressed on the fly, or
the output of a JSON preprocessor such as `jq`.

`cap-kwic -w TERM [-c NUMBER OF CONTEXT WORDS] [-s SEPARATOR] [
-H/--no-header ] [ -l/--longtitle ] [ -d/--longdate] < FILE.json > RESULTS.tsv`

E.g., to drive it directly from the `.xz` files of JSON data available
for bulk-download from CAP (for CAP-approved researchers):

`xzcat Data.xz | cap-kwic -w TERM > RESULTS.tsv`

The various `followers` tools rely on a run of both `cap-kwic` and
`cap-pos` on the same data, with the same output parameters, in order
to generate identical results. Combined with a mapfile (usually
hand-generated by the researcher), the classifications in the mapfile
can be applied to the terms in the KWIC output like so:

`cap-get-followers KWIC-POS.tsv | cap-map-followers MAPFILE "-" | cap-apply-followers "-" KWIC.tsv > RESULTS.tsv`

## Output

By default, `cap-tools` programs output data in TSV files, though the
separator can be changed on the command line. Those tools written in Awk
will need to set `FS` and `OFS` manually on the command line to
indicate the preferred separator, if using something other than `Tab`.

## Caveats

There are likely bugs, please report them! These programs were
developed on a Debian Linux system. Suggestions to enhance portability
to other Unix-like systems would be welcomed. I am not in any way
affiliated with the Caselaw Access Project.
